# HTTP

HTTP 正式作为标准被公布是在 1996 年的 5 月，版本被命名为 HTTP/1.0，1997 年 1 月公布的 HTTP/1.1 是目前主流的 HTTP 协议版本。

## 网络基础 TCP/IP

### TCP/IP 协议族

TCP/IP 协议族按层次分从下到上分别是：

- 数据链路层，用来处理连接网络的硬件部分。
- 网络层，用来处理在网络上流动的数据包。
- 传输层，提供处于网络连接中的两台计算机之间的数据传输。有 TCP 和 UDP 两个性质不同的协议。
- 应用层，决定了向用户提供应用服务时通信的活动，比如，FTP，DNS，HTTP。

### 负责传输的 IP 协议

IP （Internet Protocol）网际协议位于网络层。IP 协议的作用是把各种数据包传送给对方。其中有两个重要的条件是 IP 地址和 MAC 地址。IP 地址可变换，但 MAC 地址基本上不会更改。IP 通过 ARP 地址解析协议凭借 MAC 地址进行通信。

### 确保可靠性的 TCP 协议

为了准确无误地将数据送达目标处，TCP 协议采用了三次握手策略。

- 首先发送端发送一个带 SYN 标志的数据包给对方；
- 接收端收到后，回传一个带有 SYN+ACK 标志的数据包以示传达确认信息；
- 最后，发送端再传回传一个带 ACK 标志的数据包，代表握手结束。

### 负责域名解析的 DNS 服务

计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。比如 www.baidu.com。用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP 地址访问。所以 DNS 服务应运而生，它 提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。

## 简单的 HTTP 协议

HTTP 是一种无状态协议，对于发送过的请求或响应都不做持久化处理。但为了实现期望的保持状态功能，于是引入了 Cookie 技术。

### 请求报文

请求报文由以下几个部分构成：

- 请求方法
- 请求 URI
- 协议版本
- 可选的请求首部字段
- 内容实体

```

POST /index.html HTTP/1.1

Host: baidu.com
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

name=hhh&age=18
```

### 响应报文

响应报文由以下几个部分构成：

- 协议版本
- 状态码
- 用以解释状态码原因的短语
- 可选的响应首部字段
- 实体主体

```

HTTP/1.1 200 ok

Date: Tue, 10 Jul 2012 06:50:15 GMT
Content-Length: 362
Content-Type: text/html

<html>
...
```

### HTTP/1.1 请求方法

- GET：获取资源
- POST：传输实体主体
- PUT：传输文件
- HEAD：获得报文首部
- DELETE：删除文件
- OPTIONS：询问支持的方法
- TRACE：追踪路径
- CONNECT：要求用隧道协议连接代理

|  方法   | 支持的 HTTP 协议版本 |
| :-----: | :------------------: |
|   GET   |       1.0、1.1       |
|  POST   |       1.0、1.1       |
|   PUT   |       1.0、1.1       |
|  HEAD   |       1.0、1.1       |
| DELETE  |       1.0、1.1       |
| OPTIONS |         1.1          |
|  TRACE  |         1.1          |
| CONNECT |         1.1          |
|  LINK   |         1.0          |
| UNLINK  |         1.0          |

### 使用 Cookie 状态管理

Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。根据从服务端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值发送出去。

### 获取部分内容的范围请求

如果下载过程中遇到网络中断的情况，那就必须重头开始。为了解决上诉问题，需要一种可恢复的机制。要实现该功能需要指定下载的实体范围。执行范围请求时，会用到首部字段 Range 来指定资源的 byte 范围。

### 内容协商返回最合适的内容

内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然后提供给客户端最为合适的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。内容协商技术有以下类型：

- 服务器驱动协商
- 客户端驱动协商
- 透明协商

## HTTP 状态码

|          状态码           |                             解释                             |
| :-----------------------: | :----------------------------------------------------------: |
|          200 OK           |           从客户端发来的请求在服务器端被正常处理了           |
|      204 No Content       |                 请求处理成功，但没有资源返回                 |
|    206 Partial Content    |                     客户端进行了范围请求                     |
|   301 Moved Permanently   |         请求的资源被分配了新的 URI，以后使用新的 URI         |
|         302 Found         |     请求的资源被分配了新的 URI，希望用户本次使用新的 URI     |
|       303 See Other       |     请求的资源存在着另一个 URI，应使用 GET 方法定向获取      |
|     304 Not Modified      | 客户端发送附带条件请求时，服务器端允许请求服务资源，但请求未满足条件的情况时，服务器端资源未改变，可直接使用客户端未过期的缓存 |
|  307 Temporary Redirect   | 与 302 Found 有着相同的含义，307 会遵照浏览器标准，不会从 POST 变成 GET。 |
|      400 Bad Request      |                    请求报文中存在语法错误                    |
|     401 Unauthorized      |                发送的请求需要有通过 HTTP 认证                |
|       403 Forbidden       |                 请求资源的访问被服务器拒绝了                 |
|       404 Not Found       |                      无法找到请求的资源                      |
| 500 Internal Server Error |                 服务端在执行请求时发生了错误                 |
|  503 Service Unavailable  |            服务器暂时处于超负载或正在进行停机维护            |

